# Installation Scripts - How They Work

## Overview

The installation scripts (`install-windows.bat`, `install-macos.sh`, `install-linux.sh`) are designed to automatically install the EOPF Zarr GDAL plugin on different platforms.

## Important: Script Source

These scripts are **generated automatically** by the GitHub Actions workflow during release builds. The versions in this repository are:

- **Local copies** for testing and development
- **Templates** showing what the final scripts will contain
- **Not used directly** by end users (they get the generated versions)

## How It Works

### 1. **Development Phase** (Now)
- Scripts exist in repo for testing local builds
- Expect the directory structure you create locally
- Used for development and validation

### 2. **Release Phase** (GitHub Actions)
- Scripts are **regenerated** by the workflow
- Packaged with the correct directory structure
- Include all platform binaries and metadata

### 3. **User Phase** (End Users)
- Download complete release package from GitHub
- Use the auto-generated scripts
- Scripts automatically detect architecture and install correctly

## Expected Directory Structure for Users

When users download a release, they get:

```
eopf-zarr-gdal-plugin-v1.0.0/
├── windows/
│   └── gdal_EOPFZarr.dll
├── macos/
│   ├── x86_64/gdal_EOPFZarr.dylib
│   ├── arm64/gdal_EOPFZarr.dylib
│   └── universal/gdal_EOPFZarr.dylib
├── linux/
│   ├── release/gdal_EOPFZarr.so
│   └── debug/gdal_EOPFZarr.so
├── install-windows.bat          ← Generated by GitHub Actions
├── install-macos.sh            ← Generated by GitHub Actions  
├── install-linux.sh            ← Generated by GitHub Actions
├── GETTING_STARTED.md
└── TEST_CHECKLIST.md
```

## For Testing Locally

To test these scripts with a local build:

### 1. **Create the expected directory structure**:
```bash
mkdir -p windows macos/x86_64 macos/arm64 macos/universal linux/release linux/debug
```

### 2. **Copy your built plugin** to the appropriate directories:
```bash
# Copy your locally built DLL/dylib/so to the right place
cp build/gdal_EOPFZarr.dll windows/
cp build/gdal_EOPFZarr.dylib macos/x86_64/  # or macos/arm64/ depending on your Mac
cp build/gdal_EOPFZarr.so linux/release/
```

### 3. **Run the installation script**:
```bash
# Windows
install-windows.bat

# macOS
./install-macos.sh

# Linux  
./install-linux.sh
```

## Script Features

### **Windows (`install-windows.bat`)**
- Detects GDAL_DRIVER_PATH or uses default OSGeo4W location
- Copies DLL to plugins directory
- Provides environment setup instructions

### **macOS (`install-macos.sh`)**  
- Auto-detects Intel vs Apple Silicon architecture
- Supports universal binary option (`./install-macos.sh universal`)
- Uses Homebrew GDAL location by default
- Provides clear error messages for architecture mismatches

### **Linux (`install-linux.sh`)**
- Supports both release and debug versions (`./install-linux.sh debug`)
- Uses standard system plugin directory
- Handles permissions with sudo

## Troubleshooting

### **"File not found" errors**
- Make sure you've created the expected directory structure
- Copy your built plugin files to the correct locations
- Check that file names match exactly

### **Permission errors**
- **macOS/Linux**: Scripts may need to create directories in system locations
- **Windows**: May need admin rights for system directories

### **Architecture errors (macOS)**
- Use `./install-macos.sh universal` if you have a universal binary
- Check your architecture with `uname -m`
- Make sure you've built for the correct architecture

## Integration with GitHub Actions

The final versions of these scripts are created by the `package-release` job in `.github/workflows/main.yml`:

1. **Downloads** all platform artifacts
2. **Generates** installation scripts with correct paths
3. **Packages** everything into a release bundle
4. **Uploads** the complete package for distribution

Users never see the repository versions - they get the auto-generated ones that match their download package exactly.

---

**Note**: These local scripts are for development/testing only. Production releases use the auto-generated versions from GitHub Actions.
